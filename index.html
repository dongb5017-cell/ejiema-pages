<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
<title>中国人寿 - 取号取码工具</title>
<style>
:root{--bg:#f6f7fb;--card:#fff;--muted:#666;--accent:#0b66ff}
html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--bg);color:#111}
.container{max-width:720px;margin:0 auto;padding:14px;}
.card{background:var(--card);border-radius:14px;padding:14px;box-shadow:0 6px 18px rgba(16,24,40,0.06);}
.header{display:flex;gap:12px;align-items:center}
.logo{width:52px;height:52px;border-radius:10px;background:linear-gradient(135deg,#0b66ff,#3cc1ff);display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
h1{font-size:18px;margin:0}
p.small{margin:6px 0 12px;color:var(--muted);font-size:13px}

label{display:block;font-size:13px;color:var(--muted);margin-top:8px}
input,select,button{width:100%;box-sizing:border-box;border-radius:10px;padding:12px;border:1px solid #e6e9ef;font-size:15px}
.controls{display:flex;gap:8px;margin-top:10px}
.controls button{flex:1;padding:12px;font-weight:600}
.btn-primary{background:var(--accent);color:#fff;border:none}
.btn-ghost{background:transparent;border:1px dashed #cfd6e7;color:var(--muted)}
.small-row{display:flex;gap:8px}
.small-row input{flex:1}
pre#log{height:160px;overflow:auto;background:#fbfdff;padding:10px;border-radius:10px;border:1px solid #eef2ff;font-size:13px}
.footer{font-size:12px;color:var(--muted);text-align:center;margin-top:12px}
@media (max-width:420px){
  .header{gap:10px}
  .logo{width:44px;height:44px;font-size:16px;border-radius:8px}
  input,button{padding:10px;font-size:15px;border-radius:10px}
  pre#log{height:120px;font-size:12px}
}
</style>
</head>
<body>
<div class="container">
  <div class="card">
    <div class="header">
      <div class="logo">寿</div>
      <div>
        <h1>中国人寿 专用取号取码</h1>
        <p class="small">仅用于接收来自 <strong>中国人寿</strong> 的验证码。若浏览器提示跨域，请在下方填写代理地址。</p>
      </div>
    </div>

    <label>API 代理地址（可留空）</label>
    <input id="proxyBase" placeholder="例如 http://你的服务器:3000/proxy 或 留空" />

    <label>账号（默认已填）</label>
    <div class="small-row">
      <input id="username" value="huai10086" autocomplete="username" />
      <input id="password" value="Xx112211" type="password" autocomplete="current-password" style="width:45%" />
    </div>

    <div class="small-row" style="margin-top:8px">
      <button id="btnLogin" class="btn-primary">登录并保存 Token</button>
      <button id="btnClearToken" class="btn-ghost">登出</button>
    </div>

    <label style="margin-top:12px">服务固定为：中国人寿</label>
    <input id="fixedService" value="中国人寿" readonly />

    <label>指定手机号（可选，留空随机）</label>
    <input id="specifiedPhone" placeholder="例如 130xxxxxxxx 或 留空" />

    <div class="controls">
      <button id="btnGetPhone" class="btn-primary">取号（仅中国人寿）</button>
      <button id="btnRelease" class="btn-ghost">释放号码</button>
    </div>

    <label style="margin-top:12px">当前手机号</label>
    <input id="currentPhone" readonly />

    <label>取码行为（仅接受含有 "中国人寿" 的短信）</label>
    <div class="controls">
      <button id="btnGetMsg" class="btn-primary">立即查询短信</button>
      <button id="btnPollMsg" class="btn-ghost">轮询查询（5s）</button>
    </div>

    <label style="margin-top:12px">最近收到的验证码</label>
    <pre id="latestCode">暂无</pre>

    <label style="margin-top:8px">日志</label>
    <pre id="log"></pre>
    <p class="footer">提示：验证码将通过文本匹配 "中国人寿" 并抽取 4-6 位数字显示。</p>
  </div>
</div>
<script>
(function(){
  const API_BASE = "http://api.ejiema.com/zc/data.php";
  const $ = id => document.getElementById(id);
  const logEl = $('log'), latestEl = $('latestCode');
  function log(...a){logEl.textContent='['+new Date().toLocaleTimeString()+'] '+a.join(' ')+'\n'+logEl.textContent;}
  function getProxyBase(){return $('proxyBase').value.trim()||null;}
  function buildUrl(p){const base=getProxyBase()?getProxyBase()+"?target="+encodeURIComponent(API_BASE):API_BASE;const qs=Object.entries(p).map(([k,v])=>k+'='+encodeURIComponent(v)).join('&');return base+(base.includes('?')?'&':'?')+qs;}
  async function apiCall(p){const u=buildUrl(p);log('请求',u);const r=await fetch(u);const t=await r.text();log('返回',t);return t;}
  function token(){return localStorage.getItem('ejm_token');}function saveToken(t){t?localStorage.setItem('ejm_token',t):localStorage.removeItem('ejm_token');}
  $('btnLogin').onclick=async()=>{const r=await apiCall({code:'login',user:$('username').value,password:$('password').value});if(!r.startsWith('ERROR')){saveToken(r.trim());alert('登录成功');}};
  $('btnClearToken').onclick=()=>{saveToken(null);alert('token已清除');};
  $('btnGetPhone').onclick=async()=>{const r=await apiCall({code:'getPhone',token:token(),keyWord:'中国人寿',phone:$('specifiedPhone').value});$('currentPhone').value=r.trim();};
  $('btnRelease').onclick=()=>apiCall({code:'release',token:token(),phone:$('currentPhone').value});
  $('btnGetMsg').onclick=()=>apiCall({code:'getMsg',token:token(),phone:$('currentPhone').value,keyWord:'中国人寿'}).then(processMsg);
  let h=null;$('btnPollMsg').onclick=()=>{if(h)return;h=setInterval(()=>$('btnGetMsg').click(),5000);alert('开始轮询');};
  function processMsg(t){if(!t)return; if(t.includes('中国人寿')){const m=t.match(/(\d{4,6})/);latestEl.textContent=m?m[1]:'含中国人寿但未找到数字:\n'+t;}else log('忽略非中国人寿短信');}
})();</script>
</body></html>
